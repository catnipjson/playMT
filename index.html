
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Minor Turbulence</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
      font-family: Arial, sans-serif;
    }
    canvas {
      display: block;
      background: #222;
    }
    #ui, #menu, #deathScreen, #landedScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: white;
      background: rgba(0,0,0,0.8);
      z-index: 10;
    }
    #ui { z-index: 5; pointer-events: none; }
    #menu button, #deathScreen button, #landedScreen button {
      padding: 12px 24px;
      margin-top: 20px;
      font-size: 20px;
    }
    #minimap {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 120px;
      height: 120px;
      border: 2px solid white;
      background: #111;
      z-index: 4;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="1280" height="720"></canvas>
  <div id="ui" style="display:none;">
    <div id="altitude">Altitude: 0</div>
    <div id="status">Status: Flying</div>
  </div>
  <div id="minimap"></div>

  <div id="menu">
    <h1>MINOR TURBULENCE</h1>
    <button onclick="startGame()">Play (Commercial Jet)</button>
    <button onclick="startFreeRoam()">Free Roam (Fighter Jet)</button>
  </div>

  <div id="deathScreen" style="display:none;">
    <h1>YOU DIED</h1>
    <button onclick="goToMenu()">Main Menu</button>
  </div>

  <div id="landedScreen" style="display:none;">
    <h1>PLANE LANDED</h1>
    <button onclick="goToMenu()">Main Menu</button>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let gameRunning = false;
    let altitude = 1000;
    let status = 'Flying';
    let startTime = 0;
    let flightTimeLimit = 5 * 60 * 1000;
    let randomFailureTriggered = false;
    let planeType = 'commercial'; // or 'fighter'

    // Load audio
    const engineSound = new Audio('https://cdn.pixabay.com/download/audio/2022/10/06/audio_9d87cdedc5.mp3?filename=jet-engine-loop-121092.mp3');
    engineSound.loop = true;
    const windSound = new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_b62f119f03.mp3?filename=wind-blowing-ambient-23363.mp3');
    windSound.loop = true;
    const explosionSound = new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_b0dc1b14c3.mp3?filename=explosion-6055.mp3');
    const landingSound = new Audio('https://cdn.pixabay.com/download/audio/2022/03/15/audio_295a1a59cd.mp3?filename=landing-on-concrete-6044.mp3');

    function startGame() {
      document.getElementById('menu').style.display = 'none';
      document.getElementById('ui').style.display = 'flex';
      planeType = 'commercial';
      resetGame();
    }

    function startFreeRoam() {
      document.getElementById('menu').style.display = 'none';
      document.getElementById('ui').style.display = 'flex';
      planeType = 'fighter';
      resetGame();
    }

    function resetGame() {
      altitude = 1000;
      status = 'Flying';
      startTime = Date.now();
      randomFailureTriggered = false;
      gameRunning = true;
      engineSound.play();
      windSound.play();
      gameLoop();
    }

    function goToMenu() {
      document.getElementById('menu').style.display = 'flex';
      document.getElementById('deathScreen').style.display = 'none';
      document.getElementById('landedScreen').style.display = 'none';
      document.getElementById('ui').style.display = 'none';
      gameRunning = false;
      engineSound.pause();
      windSound.pause();
    }

    function crash() {
      explosionSound.play();
      engineSound.pause();
      windSound.pause();
      gameRunning = false;
      document.getElementById('deathScreen').style.display = 'flex';
    }

    function land() {
      landingSound.play();
      engineSound.pause();
      windSound.pause();
      gameRunning = false;
      document.getElementById('landedScreen').style.display = 'flex';
    }

    function triggerRandomFailure() {
      if (Math.random() < 0.3 && !randomFailureTriggered) {
        randomFailureTriggered = true;
        status = 'Engine Failure';
        altitude -= 5;
      }
    }

    function drawCockpit() {
      // Fake cockpit
      ctx.fillStyle = '#444';
      ctx.fillRect(0, canvas.height * 0.75, canvas.width, canvas.height * 0.25);
      ctx.fillStyle = '#888';
      ctx.fillRect(canvas.width / 2 - 100, canvas.height * 0.75, 200, 100);
    }

    function drawMap() {
      ctx.fillStyle = '#2c3e50';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#27ae60';
      ctx.fillRect(100, 100, 200, 150); // LSIA
      ctx.fillRect(canvas.width - 300, 100, 150, 100); // Grapeseed
    }

    function drawUI() {
      document.getElementById('altitude').innerText = 'Altitude: ' + altitude;
      document.getElementById('status').innerText = 'Status: ' + status;
    }

    function gameLoop() {
      if (!gameRunning) return;

      const now = Date.now();
      if (now - startTime > flightTimeLimit) {
        land();
        return;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawMap();
      drawCockpit();
      drawUI();

      triggerRandomFailure();

      // Simulate altitude drop on failure
      if (status === 'Engine Failure') {
        altitude -= 2;
        if (altitude <= 0) crash();
      }

      requestAnimationFrame(gameLoop);
    }
  </script>
</body>
</html>
