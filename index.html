
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MFS25 – A340 Flight Sim</title>
  <style>
    body { margin:0; overflow:hidden; background:#000; }
    #hud { position:absolute; top:10px; left:10px; color:#fff; font:18px sans-serif; z-index:2; }
    .controls { position:absolute; bottom:20px; left:50%; transform:translateX(-50%); display:flex; gap:10px; z-index:2 }
    .controls button { padding:12px 18px; font-size:18px; border:none; border-radius:4px; background:rgba(255,255,255,0.2); color:#fff; }
    .controls button:active { background:rgba(255,255,255,0.4); }
  </style>
</head>
<body>
  <div id="hud">Speed: <span id="speed">0</span> m/s</div>
  <div class="controls">
    <button id="leftBtn">◀ Turn</button>
    <button id="thrustUpBtn">▲ Throttle</button>
    <button id="thrustDnBtn">▼ Throttle</button>
    <button id="rightBtn">▶ Turn</button>
  </div>

  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.module.js';
    import { GLTFLoader } from 'https://cdn.jsdelivr.net/npm/three@0.150.1/examples/jsm/loaders/GLTFLoader.js';

    // Scene setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 1, 10000);
    const renderer = new THREE.WebGLRenderer({ antialias:true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Skybox
    const skyLoader = new THREE.CubeTextureLoader().setPath('https://threejs.org/examples/textures/cube/skybox/');
    const skybox = skyLoader.load(['px.jpg','nx.jpg','py.jpg','ny.jpg','pz.jpg','nz.jpg']);
    scene.background = skybox;

    // Ground plane
    const ground = new THREE.Mesh(
      new THREE.PlaneGeometry(10000,10000),
      new THREE.MeshPhongMaterial({ color: 0x228B22 })
    );
    ground.rotation.x = -Math.PI/2;
    scene.add(ground);

    // Lighting
    scene.add(new THREE.DirectionalLight(0xffffff, 0.8).position.set(100,200,100));
    scene.add(new THREE.AmbientLight(0x666666));

    // Variables
    let airplane, velocity = 0, yaw = 0;
    const loader = new GLTFLoader();
    loader.load('https://fetchcfd.com/threeDViewGltf/4934-airbus-a340-3d-model', gltf => {
      airplane = gltf.scene;
      airplane.scale.set(0.5,0.5,0.5);
      airplane.position.set(0,50,0);
      scene.add(airplane);
      animate();
    });

    // Control functions
    function throttleChange(delta) {
      velocity = Math.min(Math.max(velocity + delta, 0), 50);
    }
    function yawChange(delta) {
      yaw += delta;
    }

    // Touch & click handlers
    document.getElementById('thrustUpBtn').onpointerdown = () => throttleChange(1);
    document.getElementById('thrustDnBtn').onpointerdown = () => throttleChange(-1);
    document.getElementById('leftBtn').onpointerdown = () => yawChange(0.02);
    document.getElementById('rightBtn').onpointerdown = () => yawChange(-0.02);

    // Keyboard controls
    window.addEventListener('keydown', e => {
      if (e.key === 'ArrowUp' || e.key === 'w') throttleChange(1);
      if (e.key === 'ArrowDown' || e.key === 's') throttleChange(-1);
      if (e.key === 'ArrowLeft') yawChange(0.02);
      if (e.key === 'ArrowRight') yawChange(-0.02);
    });

    // Animation loop
    let camTarget = new THREE.Vector3();
    function animate() {
      if (!airplane) return;
      airplane.rotation.y = yaw;
      const forward = new THREE.Vector3(0,0,1).applyQuaternion(airplane.quaternion);
      airplane.position.addScaledVector(forward, velocity * 0.1);

      // Chase camera
      camTarget.copy(airplane.position)
               .add(forward.clone().multiplyScalar(-100))
               .add(new THREE.Vector3(0,40,0));
      camera.position.lerp(camTarget, 0.1);
      camera.lookAt(airplane.position);

      document.getElementById('speed').innerText = Math.round(velocity);

      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
  </script>
</body>
</html>
